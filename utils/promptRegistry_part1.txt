/**
 * 中文网文提示词注册表 - 所有AI提示词的中文化版本
 */

import { registerPromptTemplate, PromptNames } from './promptLoader';
import { CHAPTER_WRITING_SYSTEM_PROMPT, CHAPTER_WRITING_USER_PROMPT } from './chapterWritingPrompt';

// 注册所有提示词模板
export function initializePrompts() {

  registerPromptTemplate(PromptNames.STORY_OUTLINE, {
    systemPrompt: `你是一位专业的中文网文作者和编辑，擅长创作引人入胜、结构完整、细节丰富的故事大纲。`,
    userPrompt: `根据以下故事设定，为一部 {{chapters_count}} 章的网文创建详细的故事大纲。大纲应该全面覆盖主要情节点、角色弧线、支线情节和故事各部分（开头、发展、高潮、结局）的关键事件。

故事设定："{{story_premise}}"

**🚫 关键：禁用词 - 不要在任何地方使用：**
绝不使用以下词汇（包括角色名、地名或描述）：
- "一股强大的气息"或任何衍生（"一股XX的气息"）
- "浑身一震""身体一震"
- "心中暗道""暗自思忖""心中想到"
- "缓缓说道""淡淡地说""冷冷地说"
- "目光如炬""宛如天神"

使用替代表达：具体的动作、真实的反应、自然的对话。
这适用于大纲的所有部分，包括角色名和地点。

请用以下明确标记的部分结构化你的回答：
1. **故事梗概：** 一句话概括核心冲突。
2. **主要角色：** 列出主要角色，每个角色2-3句简介，说明性格、动机和核心冲突/成长弧线。
3. **故事架构（网文三幕式结构）：**
   * **第一幕（开篇勾引）：** 介绍世界和角色，激发事件，主角初始目标，设置悬念。（占前 25% 章节）
   * **第二幕（矛盾升级）：** 上升动作，新挑战，角色发展，引入盟友和敌人，中点（重大转折），不断升级的赌注，小高潮迭起。（占接下来 50% 章节）
   * **第三幕（高潮收尾）：** 最终高潮，结局，主要情节和角色弧线的解决。（占最后 25% 章节）
4. **世界观设定：** 关于设定、力量体系（如果有）、文化等的关键细节。
5. **重复主题/母题：** 列出 3-5 个将贯穿叙事的反复出现的符号、想法或主题。

**网文特色要求：**
- 如果是修仙/玄幻类，要设定清晰的等级体系和修炼系统
- 设计主角的"金手指"（外挂/系统/特殊能力），要有限制
- 规划"爽点"节奏：打脸、突破、获宝、制敌等高潮点
- 每个大情节段落都要有明确的"地图升级"（村→镇→城→国→大陆）
- 设置明确的势力格局和主角的攀升路径`
  });

  registerPromptTemplate(PromptNames.CHAPTER_PLANNING, {
    systemPrompt: `你是章节规划专家，创建详细的逐章计划。你的输出必须符合提供的 JSON schema。聚焦冲突、角色发展和叙事动力。`,
    userPrompt: `为基于这个故事大纲的 {{num_chapters}} 章创建详细计划。每章需要具体的冲突、角色成长和向前推进的动力。

**🎯 五大规划优先事项：**

1. **每章都有冲突** - 指定 'conflictType'：
   - 外部：战斗、障碍、追逐
   - 内部：道德困境、自我怀疑、艰难选择
   - 人际：关系紧张、背叛、竞争
   - 社会：系统 vs 个人、腐败、不公

2. **道德复杂性** - 指定 'moralDilemma'：
   - 没有简单答案，角色面对不可能的选择
   - 好人做出可疑的决定
   - 对手有可理解的动机
   - 展示每个选择的后果

3. **角色深度** - 指定 'characterComplexity'：
   - 揭示矛盾和缺陷
   - 驱动外部行动的内部冲突
   - 通过艰难决定实现角色改变
   - 避免刻板印象，创造复杂的人

4. **节奏韵律** - 指定 'rhythmPacing'（快/中/慢）：
   - 快：动作密集，对话驱动的场景
   - 中：平衡动作和内省
   - 慢：角色发展，世界构建
   - 跨章节刻意交替

5. **升级紧张度** - 评定 'tensionLevel'（1-10）：
   - 系统性地向高潮构建
   - 创造高峰和策略性低谷
   - 个人利害关系先于全球利害
   - 每章提高风险

**📋 章节结构模板：**
- **开头：** 连接上一章的钩子
- **发展：** 一个重大事件 + 一个角色变化
- **复杂化：** 新问题或揭示
- **升级：** 提高赌注或揭示后果
- **钩子结尾：** 为下一章留下问题或威胁

**⚡ 特殊章节类型：**

**第 1-3 章（钩子阶段）：**
- 优先考虑情节动力而非世界构建
- 快速建立冲突
- 在行动中展示角色，而非描述

**中间章节（反低潮规则）：**
- 变化模式：不要有两个连续章节结构相同
- 引入新复杂情况 vs 重复旧的
- 改变地点，添加角色，揭示信息
- 避免"又一次追逐/战斗/背叛" - 让每个独特

**最后章节（解决阶段）：**
- 清晰解决所有建立的冲突
- 英雄必须被旅程改变（身体/心理伤疤）
- 胜利的代价 - 某些东西永久改变
- 内部成长与外部胜利同样重要

**网文专属规划：**

**爽点分布：**
- 每 3-5 章一个小爽点（打脸、小突破、小收获）
- 每 10-15 章一个大爽点（境界突破、大战胜利、地图升级）
- 最后 10% 章节是终极高潮

**断章技巧：**
- 75% 的章节要在悬念处结束
- 在关键对话、战斗高潮、重大揭示处断章
- 让读者急于看下一章

**📖 示例章节结构：**
第 3 章："背叛"
- conflictType: "人际"
- moralDilemma: "主角必须在救朋友或完成任务间选择"
- characterComplexity: "英雄意识到他们享受所对抗的权力"
- tensionLevel: 7
- rhythmPacing: "快"
- consequencesOfChoices: "朋友的信任破裂，任务妥协"

**🏗️ 要规划的故事大纲：**
{{story_outline}}

生成完整的章节计划（第 1 到 {{num_chapters}} 章），填写所有必需字段。`
  });

  registerPromptTemplate(PromptNames.CHAPTER_ANALYSIS, {
    systemPrompt: `你是一位细致的文学分析师。你的任务是分析章节内容并提取关键信息，严格符合提供的 JSON schema。`,
    userPrompt: `分析第 {{chapter_number}} 章（"{{chapter_title}}"）提供的内容。提取所需信息并以指定的 JSON 格式提供。

章节内容：
{{chapter_content}}`
  });

  registerPromptTemplate(PromptNames.SELF_CRITIQUE, {
    systemPrompt: `你是一位写作教练，专门检测AI生成的模式，让文本感觉像人写的。`,
    userPrompt: `分析本章是否有AI生成的模式，使文本感觉人工化。聚焦于使其更人性化。

**第 {{chapter_number}} 章 - "{{chapter_title}}"：**
{{chapter_content_preview}}

**🤖 AI模式检测（优先级1）：**
1. **结构模板化：** 本章是否像其他章节一样开始/发展？标记机械重复。
2. **情感过度：** 所有感觉都达到最大强度吗？（"压倒性的恐惧" vs 自然的"不安"）
3. **过度解释：** 文本是否解释了已经展示的内容？（"他很生气因为..."）
4. **完美文笔：** 节奏太流畅吗？如果没有笨拙/破碎的句子就标记。
5. **人工美感：** 为了美而描述 vs 功能？（"空灵的月光" vs 有用的细节）

**👤 缺失的人性：**
6. **个人怪异：** 角色注意到任何与情节无关的怪异/不相关事物吗？
7. **身体现实：** 任何平凡需求吗？（饥饿、不适、随机想法）
8. **不完美：** 任何绊倒、误听、不理性时刻？
9. **未解决元素：** 任何提到但未解释的东西？
10. **对话现实：** 人们打断、说"嗯"、误解吗？

**中文网文AI痕迹检查：**
- 是否使用了禁用套话（"一股强大的气息""浑身一震""心中暗道"）？
- 四字成语是否过度堆砌？
- 境界突破是否描写得太模板化？
- 打脸情节是否太机械？

**💭 主观性检查：**
- 角色只想与情节相关的事吗？（添加随机离题）
- 所有比喻都可预测吗？（需要个人的、怪异的联想）
- 太多文学结构？（需要更简单、具体的语言）

**🎯 回应格式：**
列出发现的具体AI模式：
- "机械结构：开始方式与第 X 章完全相同..."
- "情感过度：'压倒性的绝望' - 使用更小的情绪"
- "缺失人性：没有个人细节或随机想法"
- "过度美化：'古老神秘的能量' - 改为具体"

如果章节感觉像人写的，说"感觉像人写的"并注明有效之处。

**聚焦于让文本感觉像真人写的，而非文学生成器。**`
  });

