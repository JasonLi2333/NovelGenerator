# NovelGenerator 模型选择策略

本文档针对**中文小说创作**场景，提供三种模型配置方案。

---

## 核心原则

1. **中文创作质量优先**：所有涉及中文对话、描写、连贯性的环节必须使用 DeepSeek
2. **充分利用免费额度**：OpenAI Mini 系列 25M tokens/天（优先用 Mini 而非 Nano），Gemini 系列免费
3. **成本控制**：在保证质量前提下最小化付费成本

### 💡 为什么用 Mini 不用 Nano？

| 维度 | 结论 |
|------|------|
| **在免费额度内** | Mini 和 Nano 成本都是 $0 |
| **质量** | Mini 更好（价格贵 5 倍） |
| **每本消耗** | ~3M tokens（OpenAI部分） |
| **免费额度** | 25M/天，可生成 8+ 本 |
| **最终选择** | ✅ **用 Mini**（质量好+免费） |

**简单说：** 反正都免费，为什么不用更好的？

---

## 方案对比总览

| 方案 | 定位 | 成本/本（10章） | 中文质量 | 适用场景 |
|------|------|----------------|---------|---------|
| **方案A：经济实惠** | 性价比最优 | **$0.48** | ⭐⭐⭐⭐⭐ | 🏆 **日常创作首选** |
| **方案B：全免费** | 零成本方案 | **$0** | ⭐⭐⭐ | 预算为0，测试验证 |
| **方案C：顶级质量** | 出版级品质 | **$0.48** | ⭐⭐⭐⭐⭐ | 商业出版，追求极致 |

---

## 方案 A：经济实惠方案（推荐）

**核心理念：** 规划用免费，创作用 DeepSeek（中文最佳），分析用免费

### 模型配置

| 环节 | 模型 | 免费/付费 | 理由 |
|------|------|----------|------|
| **1. 故事大纲生成** | **gpt-5** 🎯 | ✅ 免费 | 250K/天额度，**顶级创意构思**（决定作品高度） |
| **2. 角色提取** | **gpt-4.1-mini** | ✅ 免费 | 25M/天额度，1M上下文（处理长大纲） |
| **3. 世界观提取** | **gpt-4.1-mini** | ✅ 免费 | 同上 |
| **4. 主题元素提取** | **gpt-4.1-mini** | ✅ 免费 | 同上 |
| **5. 章节计划生成** | **gpt-5-mini** | ✅ 免费 | 25M/天额度，JSON Schema稳定，质量最好 |
| **6a. 结构Agent** | **deepseek-chat** | 💰 付费 | 🇨🇳 **中文叙事框架最佳** |
| **6b. 角色Agent** | **deepseek-chat** | 💰 付费 | 🇨🇳 **中文对话最自然** |
| **6c. 场景Agent** | **deepseek-chat** | 💰 付费 | 🇨🇳 **中文描写最细腻** |
| **7. 内容整合** | **deepseek-chat** | 💰 付费 | 🇨🇳 **中文连贯性最佳** |
| **8. 章节分析** | **gpt-4.1-mini** | ✅ 免费 | 25M/天额度，1M上下文，JSON提取准确 |
| **9. 自我批评** | **gpt-4.1-mini** | ✅ 免费 | 25M/天额度，批评能力优于nano |
| **10. 编辑打磨** | **deepseek-chat** | 💰 付费 | 🇨🇳 **中文文笔润色最佳** |
| **11. 书名生成** | **gpt-5-mini** | ✅ 免费 | 25M/天额度，创意营销能力更强 |

### 成本详细计算（10章小说）

| 阶段 | Token消耗 | 模型 | 理论成本 | 免费额度后 |
|------|----------|------|---------|-----------|
| **1. 大纲（关键）** | ~10K | **gpt-5** 🎯 | $0.10 | **$0** ✅ |
| **2-5. 规划** | ~140K | gpt-mini系列 | $0.28 | **$0** ✅ |
| **6-7. 生成** | ~12M | deepseek-chat（Cache优化） | $0.38 | **$0.38** 💰 |
| **8-10. 打磨** | ~2.8M | deepseek-chat + gpt-mini | $0.10 | **$0.10** 💰 |
| **11. 书名** | ~20K | gpt-5-mini | $0.04 | **$0** ✅ |
| **总计** | ~15M | - | $0.90 | **$0.48** ✅ |

**免费额度说明：**
- GPT-5：10K tokens < 250K/天免费额度 ✅
- Mini系列：160K tokens < 25M/天免费额度 ✅
- DeepSeek：12.8M tokens（付费，但很便宜）

### DeepSeek Cache 优化策略

```typescript
// 环节6-7：章节生成（每章）
输入: 50K tokens × 3 agents = 150K tokens
  - Cache Hit (90%): 135K × $0.028/M = $0.0038
  - Cache Miss (10%): 15K × $0.28/M = $0.0042
输出: 6K tokens × 3 agents = 18K × $0.42/M = $0.0076
小计: $0.016/章

// 环节10：编辑打磨（每章4轮）
输入: 15K × 4轮 = 60K tokens
  - Cache Hit (80%): 48K × $0.028/M = $0.0013
  - Cache Miss (20%): 12K × $0.28/M = $0.0034
输出: 8K × 4轮 = 32K × $0.42/M = $0.0134
小计: $0.018/章

// 每章总成本: $0.016 + $0.018 = $0.034
// 10章总成本: $0.034 × 10 = $0.34
```

### OpenAI 免费额度使用情况

```
GPT-5 系列每日额度: 250,000 tokens
Mini 系列每日额度: 25,000,000 tokens

每本消耗（方案A）:
- GPT-5: 10K tokens（故事大纲）
- Mini: 160K tokens（规划+分析）
- 合计: 170K tokens

每日生成能力:
- GPT-5 限制: 250K/10K = 25 本
- Mini 限制: 25M/160K = 156 本
- 瓶颈: DeepSeek 成本（无限制）

结论: 每天可生成 25+ 本，全部在免费额度内！
```

**方案A的独特优势：**
- ✅ 大纲用 **GPT-5**（顶级创意，决定作品高度）
- ✅ 中文用 **DeepSeek**（最佳阅读体验）
- ✅ 其他用 **Mini**（免费且质量好）
- ✅ 成本依然只有 **$0.48/本**

### 优劣分析

✅ **优势：**
- **故事创意顶级**（GPT-5 大纲构思）🎯
- **中文创作质量顶级**（DeepSeek 专长）🇨🇳
- 成本极低（$0.48/本）💰
- 免费额度覆盖非中文环节 ✅
- Cache 优化后性价比最高 📈

⚠️ **注意事项：**
- 需要配置 OpenAI + DeepSeek 双 API Key
- 核心创作环节付费（但很便宜）
- 每日受 GPT-5 免费额度限制（250K tokens/天，约 25 本）

---

## 方案 B：全免费方案

**核心理念：** 零预算，充分利用 OpenAI 和 Gemini 免费额度

### 模型配置

| 环节 | 模型 | 理由 |
|------|------|------|
| **1. 故事大纲生成** | **gpt-5-mini** | 25M/天免费，128K输出，质量最好 |
| **2. 角色提取** | **gpt-4.1-mini** | 25M/天免费，1M上下文 |
| **3. 世界观提取** | **gpt-4.1-mini** | 同上 |
| **4. 主题元素提取** | **gpt-4.1-mini** | 同上 |
| **5. 章节计划生成** | **gpt-5-mini** | 25M/天免费，JSON稳定，质量好 |
| **6a. 结构Agent** | **gpt-5-mini** | 25M/天免费，128K输出，质量好 |
| **6b. 角色Agent** | **gpt-5-mini** | 同上 |
| **6c. 场景Agent** | **gpt-5-mini** | 同上 |
| **7. 内容整合** | **gpt-5-mini** | 同上 |
| **8. 章节分析** | **gpt-4.1-mini** | 25M/天免费，1M上下文 |
| **9. 自我批评** | **gpt-4.1-mini** | 25M/天免费，批评能力好 |
| **10. 编辑打磨** | **gpt-5-mini** | 25M/天免费，润色能力好 |
| **11. 书名生成** | **gpt-5-mini** | 25M/天免费，创意强 |

### 成本详细计算（10章小说）

| 阶段 | Token消耗 | 模型 | 成本 |
|------|----------|------|------|
| **所有环节** | ~15M | gpt-nano系列 + gemini | **$0（免费）** |

### 免费额度限制

```
OpenAI Mini 系列: 25M tokens/天
每本消耗: ~15M tokens
结论: 每天可生成 1.6 本小说

如果超出额度（选项）:
1. 等待次日重置（最简单）
2. 使用 Gemini 系列补充（也免费）
3. 切换到 nano 系列（付费但便宜 5 倍）
```

### 优劣分析

✅ **优势：**
- 完全免费，零成本
- 适合大量测试、验证想法
- 英文质量优秀

⚠️ **劣势：**
- 中文表现不如 DeepSeek
- 每日生成数量受限（1-2本）
- 对话、描写的地道性略逊

**📌 适用场景：**
- 预算为 0 的个人项目
- 快速验证故事创意
- 英文小说创作
- 学习和测试系统

---

## 方案 C：顶级质量方案

**核心理念：** 需要顶级创意的用 GPT-5，读者阅读体验用 DeepSeek

### 设计哲学

将小说创作分为两类环节：

1. **创意规划环节**（需要顶级智能）
   - 故事大纲构思
   - 章节结构设计
   - 这些环节决定作品的「骨架」和「灵魂」
   - → 使用 **GPT-5**（最强创意）

2. **读者体验环节**（需要中文最佳）
   - 角色对话
   - 场景描写
   - 情节连贯
   - 文笔打磨
   - 这些环节决定「读者的阅读体验」
   - → 使用 **DeepSeek**（中文最佳）

3. **辅助分析环节**（工具性任务）
   - 信息提取
   - 结构分析
   - → 使用 **OpenAI 免费额度**（省钱）

### 模型配置

| 环节 | 模型 | 免费/付费 | 理由 |
|------|------|----------|------|
| **1. 故事大纲生成** | **gpt-5** | 💰 付费 | 🎯 **顶级创意构思**（决定作品高度） |
| **2. 角色提取** | **gpt-4.1-mini** | ✅ 免费 | 工具性任务，mini 足够（1M上下文） |
| **3. 世界观提取** | **gpt-4.1-mini** | ✅ 免费 | 同上 |
| **4. 主题元素提取** | **gpt-4.1-mini** | ✅ 免费 | 同上 |
| **5. 章节计划生成** | **gpt-5** | 💰 付费 | 🎯 **顶级结构设计**（决定故事节奏） |
| **6a. 结构Agent** | **deepseek-chat** | 💰 付费 | 📖 **中文叙事框架**（读者体验） |
| **6b. 角色Agent** | **deepseek-chat** | 💰 付费 | 📖 **中文对话自然**（读者体验） |
| **6c. 场景Agent** | **deepseek-chat** | 💰 付费 | 📖 **中文描写细腻**（读者体验） |
| **7. 内容整合** | **deepseek-chat** | 💰 付费 | 📖 **中文连贯流畅**（读者体验） |
| **8. 章节分析** | **gpt-4.1-mini** | ✅ 免费 | 工具性任务，mini 足够（1M上下文） |
| **9. 自我批评** | **gpt-5** | 💰 付费 | 🎯 **顶级质量把控** |
| **10. 编辑打磨** | **deepseek-chat** | 💰 付费 | 📖 **中文文笔打磨**（读者体验） |
| **11. 书名生成** | **gpt-5** | 💰 付费 | 🎯 **顶级营销创意** |

### 成本详细计算（10章小说）

| 环节 | Token消耗 | 模型 | 成本（超额后） | 免费额度内 |
|------|----------|------|--------------|-----------|
| **1. 大纲** | 10K | gpt-5 | $0.10 | ✅ $0 |
| **2-4. 提取** | 36K | gpt-4.1-mini | $0.06 | ✅ $0 |
| **5. 规划** | 25K | gpt-5 | $0.25 | ✅ $0 |
| **6-7. 生成** | 12M | deepseek-chat | $0.38 | ❌ $0.38 |
| **8. 分析** | 140K | gpt-4.1-mini | $0.22 | ✅ $0 |
| **9. 批评** | 110K | gpt-5 | $1.10 | ✅ $0 |
| **10. 打磨** | 2.8M | deepseek-chat | $0.10 | ❌ $0.10 |
| **11. 书名** | 20K | gpt-5 | $0.20 | ✅ $0 |
| **理论总计** | ~15M | - | $2.43 | - |
| **实际总计** | ~15M | - | - | **$0.48** ✅ |

### OpenAI 免费额度抵扣

```
GPT-5 系列每日免费额度: 250,000 tokens
Mini/Nano 系列每日免费额度: 25,000,000 tokens

方案C中消耗（每本）:
- GPT-5 部分: 165K tokens (大纲+规划+批评+书名)
- Mini 部分: 36K tokens (提取+分析)
- DeepSeek 部分: 12M tokens (中文创作)

结论: 
- GPT-5 消耗在免费额度内 (165K < 250K) ✅
- Mini 消耗在免费额度内 (36K << 25M) ✅
- 实际成本仅为 DeepSeek 部分: $0.48
- 最终成本: $0.48/本 ✅
```

### 实际成本

| 项目 | 成本 |
|------|------|
| GPT-5 部分 | $0（免费额度内） |
| DeepSeek 部分 | $0.48 |
| **总计** | **$0.48/本** |

**🎉 惊喜发现：方案C实际成本 = 方案A成本！**

### 优劣分析

✅ **优势：**
- 故事创意顶级（GPT-5 规划）
- 中文体验顶级（DeepSeek 写作）
- 成本依然很低（$0.48/本）
- GPT-5 在免费额度内使用
- 质量把控最严格

⚠️ **注意事项：**
- 需要配置 OpenAI + DeepSeek 双 API Key
- GPT-5 免费额度有日限（250K tokens/天）
- 每天约可生成 1-2 本（受 GPT-5 额度限制）

**📌 适用场景：**
- 商业出版项目
- 追求极致品质
- 需要顶级故事创意
- 预算 < $1/本

---

## 三方案对比详解

### 成本对比（10章小说）

| 方案 | 实际成本 | OpenAI消耗 | DeepSeek消耗 | Gemini消耗 |
|------|---------|-----------|-------------|-----------|
| **A. 经济实惠** | $0.48 | 10K GPT-5（免费）<br>160K mini（免费） | 12M（$0.48） | 0 |
| **B. 全免费** | $0 | 14M（免费） | 0 | 1M（免费） |
| **C. 顶级质量** | $0.48 | 165K GPT-5（免费）<br>36K mini系列（免费） | 12M（$0.48） | 0 |

### 质量对比

| 维度 | 方案A | 方案B | 方案C |
|------|-------|-------|-------|
| **故事创意** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **结构设计** | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **中文对话** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **场景描写** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **文笔打磨** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **质量把控** | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **综合评分** | **4.8/5** | **3.0/5** | **5.0/5** |

### 使用限制

| 方案 | 每日生成量 | 额度限制 | API Key需求 |
|------|-----------|---------|------------|
| **A** | 25+ 本 | GPT-5: 250K/天<br>成本: $0.48/本 | OpenAI + DeepSeek |
| **B** | 1-2本 | OpenAI: 25M/天 | OpenAI（+ Gemini可选） |
| **C** | 1-2本 | GPT-5: 250K/天<br>nano系列: 25M/天 | OpenAI + DeepSeek |

---

## 推荐决策树

```
开始
  │
  ├─ 预算为0？
  │   └─ 是 → 方案B（全免费）
  │   └─ 否 → 继续
  │
  ├─ 追求极致品质？（商业出版）
  │   └─ 是 → 方案C（顶级质量）
  │   └─ 否 → 继续
  │
  └─ 日常创作，性价比优先？
      └─ 是 → 方案A（经济实惠）✅ 推荐
```

---

## 实施建议

### 配置文件示例

```typescript
// config/model-strategy.ts

export enum Strategy {
  ECONOMIC = 'economic',      // 方案A
  FREE = 'free',              // 方案B
  PREMIUM = 'premium',        // 方案C
  TEST = 'test'               // 测试方案
}

export const MODEL_CONFIG = {
  [Strategy.ECONOMIC]: {
    outline: 'gpt-5',             // 🎯 顶级创意（250K/天免费）
    extraction: 'gpt-4.1-mini',   // 免费额度内，用 mini（1M上下文）
    planning: 'gpt-5-mini',       // 免费额度内，用质量更好的 mini
    structure: 'deepseek-chat',   // 🇨🇳 中文最佳
    character: 'deepseek-chat',   // 🇨🇳 中文最佳
    scene: 'deepseek-chat',       // 🇨🇳 中文最佳
    synthesis: 'deepseek-chat',   // 🇨🇳 中文最佳
    analysis: 'gpt-4.1-mini',     // 免费额度内
    critique: 'gpt-4.1-mini',     // 免费额度内
    polish: 'deepseek-chat',      // 🇨🇳 中文最佳
    title: 'gpt-5-mini',          // 免费额度内
  },
  
  [Strategy.FREE]: {
    outline: 'gpt-5-mini',     
    extraction: 'gpt-4.1-mini',   
    planning: 'gpt-5-mini',       
    structure: 'gpt-5-mini',      
    character: 'gpt-5-mini',     
    scene: 'gpt-5-mini',   
    synthesis: 'gpt-5-mini',    
    analysis: 'gpt-4.1-mini',      
    critique: 'gpt-4.1-mini', 
    polish: 'gpt-5-mini',      
    title: 'gpt-5-mini',   
  },
  
  [Strategy.PREMIUM]: {
    outline: 'gpt-5',
    extraction: 'gpt-4.1-mini',   // 工具任务用 mini（免费+质量好）
    planning: 'gpt-5',
    structure: 'deepseek-chat',
    character: 'deepseek-chat',
    scene: 'deepseek-chat',
    synthesis: 'deepseek-chat',
    analysis: 'gpt-4.1-mini',     // 工具任务用 mini
    critique: 'gpt-5',
    polish: 'deepseek-chat',
    title: 'gpt-5',
  },
  
  [Strategy.TEST]: {
    outline: 'gpt-5-nano',     
    extraction: 'gpt-4.1-nano',   
    planning: 'gpt-5-nano',       
    structure: 'gpt-5-nano',      
    character: 'gpt-5-nano',     
    scene: 'gpt-5-nano',   
    synthesis: 'gpt-5-nano',    
    analysis: 'gpt-4.1-nano',      
    critique: 'gpt-4.1-nano', 
    polish: 'gpt-5-nano',      
    title: 'gpt-5-nano',   
  }
};
```

### API Key 配置

```bash
# .env

# 方案A 需要
OPENAI_API_KEY=sk-xxx           # OpenAI（免费额度）
DEEPSEEK_API_KEY=sk-xxx         # DeepSeek（付费）

# 方案B 需要
OPENAI_API_KEY=sk-xxx           # OpenAI（免费额度）
GEMINI_API_KEY=xxx              # Gemini（免费，可选）

# 方案C 需要
OPENAI_API_KEY=sk-xxx           # OpenAI（免费额度）
DEEPSEEK_API_KEY=sk-xxx         # DeepSeek（付费）
```

---

## Mini vs Nano 详细对比

### 为什么选择 Mini？

| 对比维度 | gpt-5-mini | gpt-5-nano | 结论 |
|---------|-----------|-----------|------|
| **输出质量** | ⭐⭐⭐⭐ | ⭐⭐⭐ | mini 更强 |
| **输出价格** | $2.00/M | $0.40/M | nano 便宜 5 倍 |
| **免费额度** | 25M/天 | 25M/天 | 相同 |
| **在额度内成本** | **$0** | **$0** | **相同** ✅ |
| **超出额度成本** | 高 | 低 | nano 更省 |
| **输出能力** | 128K | 128K | 相同 |
| **上下文** | 400K | 400K | 相同 |

**结论：**
- ✅ **日常使用（1-2本/天）**: 用 **mini**（质量更好，完全免费）
- ⚠️ **大量生产（3+本/天）**: 考虑 **nano**（超额后便宜）
- 💡 **成本优先**: 直接用 **nano**（未来超额时省钱）

### 4.1 系列的优势

| 对比维度 | gpt-5-mini | gpt-4.1-mini | 选择建议 |
|---------|-----------|-------------|---------|
| **上下文** | 400K | **1M** ⭐ | 需要超长上下文 → 4.1 |
| **输出能力** | 128K | 32K | 需要超长输出 → 5 |
| **输出价格** | $2.00/M | $1.60/M | 4.1 更便宜 |
| **适用场景** | 创意生成 | 分析/提取 | 工具任务 → 4.1 |

**本方案的选择策略：**
- **创意环节**（大纲、规划、书名）→ **gpt-5-mini**（128K 输出 + 创意强）
- **分析环节**（提取、分析、批评）→ **gpt-4.1-mini**（1M 上下文 + 便宜）

---

## 常见问题

### Q1: 为什么不全用 DeepSeek？
**A:** 规划和分析环节不需要中文优势，用免费额度更划算。DeepSeek 专注在中文创作的核心环节，发挥最大价值。

### Q1.5: 为什么用 mini 而不是 nano？
**A:** 
- **在免费额度内**（每天 1-2 本）：成本都是 $0，应该用质量更好的 **mini**
- **超出免费额度时**：
  - 预算充足 → 继续用 mini（质量优先）
  - 成本敏感 → 切换到 nano（便宜 5 倍）
- **需要超长上下文**：用 4.1 系列（1M 上下文 vs mini 的 400K）
- 本方案默认每天生成 1-2 本，在免费额度内，所以优先 mini

### Q2: 方案C和方案A成本一样，为什么还要方案A？
**A:** 
- **方案A**：大纲用GPT-5，其他规划用Mini，每天可生成 25+ 本
- **方案C**：大纲+规划+批评都用GPT-5，GPT-5消耗更多（165K/本），每天约 1-2 本
- 方案A更适合日常大量创作，方案C适合精品打磨（每个批评环节都用GPT-5）

### Q3: Gemini 在哪些环节有优势？
**A:** 
- 分析提取类任务（免费）
- 1M超长上下文（适合处理大量背景信息）
- 作为OpenAI免费额度用尽后的备选

### Q4: 如何选择最适合自己的方案？
**A:**
- **学生/爱好者** → 方案B（全免费）
- **业余作者/日常创作** → 方案A（$0.48/本，GPT-5大纲+DeepSeek中文，每日25+本）🏆
- **职业作者/出版社** → 方案C（全流程顶级品质，每个环节都最优，每日1-2本）

### Q5: 可以混合使用吗？
**A:** 可以！建议策略：
- 初稿用方案B（免费验证创意）
- 正式版用方案A（日常创作）
- 出版版用方案C（追求极致）

---

## 更新日志

- **2026-02-06**: 初始版本，基于最新API价格和免费额度
- 重点优化中文创作场景
- 充分利用 OpenAI 25M/天免费额度
- DeepSeek 专注中文核心创作环节

---

## 参考文档

- [model-handbook.md](./model-handbook.md) - 完整模型技术规格
- [OpenAI API 文档](https://platform.openai.com/docs)
- [DeepSeek API 文档](https://api.deepseek.com)
- [Gemini API 文档](https://ai.google.dev)
